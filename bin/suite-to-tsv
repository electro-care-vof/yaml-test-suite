#!/usr/bin/env perl

use v5.18;
use FindBin;
use lib $FindBin::Bin;
use base 'YAMLTestSuite';
use Encode;

main->new->run([@ARGV]);

sub make {
  my ($self) = @_;

  my $id = $self->{ID};
  my $data = $self->{data};

  my $name = $data->{name};

  my $skip = $data->{skip} ? 'X' : '';

  my $yaml = $data->{yaml};
  $yaml =~ s/"/""/g;
  $yaml = qq{"$yaml"};

  my $tree = $data->{tree};
  $tree =~ s/"/""/g;
  chomp $tree;
  $tree = qq{"$tree"};

  my $play = $self->play_url($data->{yaml});

  my $tsv = encode_utf8 join("\t",
    (
      $play,
      $id,
      $name,
      $yaml,
      $tree,
    )
  ) . "\n";

  print $tsv;
}

sub final {
  my ($self) = @_;
  warn "Wrote $self->{make} rows.\n";
}
